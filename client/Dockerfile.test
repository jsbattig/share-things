# Test Dockerfile for ShareThings Client
FROM node:18-alpine

WORKDIR /app

# Set environment variables
ENV NODE_ENV=test
ENV TS_NODE_TRANSPILE_ONLY=true

# Copy package files and install all dependencies (including dev dependencies)
COPY package*.json ./
RUN npm install

# Copy source code
COPY . .

# Create a tsconfig.test.json file that skips type checking
RUN echo '{"extends": "./tsconfig.json", "compilerOptions": {"noEmit": true, "skipLibCheck": true}}' > tsconfig.test.json

# Expose the port
EXPOSE 3000

# Default command (can be overridden)
# Use vitest directly with no-typecheck to bypass TypeScript compilation errors
CMD ["npx", "vitest", "run", "--no-typecheck", "--config", "vitest.config.ts"]